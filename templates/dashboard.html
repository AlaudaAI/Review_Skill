{% extends "base.html" %}
{% block title %}Dashboard - Review Boost{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-6">Dashboard</h1>

<form method="get" class="mb-6 flex items-end gap-3">
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Business</label>
        <select name="business_id"
                class="border rounded px-3 py-2 text-sm focus:ring-blue-500 focus:border-blue-500">
            <option value="">-- Select --</option>
            {% for biz in businesses %}
            <option value="{{ biz.id }}" {% if selected_id == biz.id %}selected{% endif %}>
                {{ biz.name }}
            </option>
            {% endfor %}
        </select>
    </div>
    <button type="submit"
            class="bg-gray-200 text-gray-700 px-4 py-2 rounded text-sm hover:bg-gray-300">
        View
    </button>
</form>

{% if stats %}
<div class="grid grid-cols-3 gap-4 mb-8">
    <div class="bg-white rounded-lg shadow p-4 text-center">
        <div class="text-2xl font-bold text-blue-600">{{ stats.total_sent }}</div>
        <div class="text-xs text-gray-500">Sent</div>
    </div>
    <div class="bg-white rounded-lg shadow p-4 text-center">
        <div class="text-2xl font-bold text-green-600">{{ stats.total_clicked }}</div>
        <div class="text-xs text-gray-500">Clicked</div>
    </div>
    <div class="bg-white rounded-lg shadow p-4 text-center">
        <div class="text-2xl font-bold text-purple-600">{{ stats.click_rate }}%</div>
        <div class="text-xs text-gray-500">Click Rate</div>
    </div>
</div>

{% if reviews %}
<div class="bg-white rounded-lg shadow overflow-hidden">
    <table class="w-full text-sm">
        <thead class="bg-gray-50">
            <tr>
                <th class="text-left px-4 py-2">Customer</th>
                <th class="text-left px-4 py-2">Contact</th>
                <th class="text-left px-4 py-2">Status</th>
                <th class="text-left px-4 py-2">Sent</th>
                <th class="text-left px-4 py-2">Clicked</th>
            </tr>
        </thead>
        <tbody>
            {% for r in reviews %}
            <tr class="border-t">
                <td class="px-4 py-2">{{ r.customer_name }}</td>
                <td class="px-4 py-2 text-gray-500">{{ r.customer_contact }}</td>
                <td class="px-4 py-2">
                    {% if r.status == "clicked" %}
                    <span class="text-green-600 font-medium">Clicked</span>
                    {% elif r.status == "sent" %}
                    <span class="text-blue-600">Sent</span>
                    {% else %}
                    <span class="text-gray-400">Pending</span>
                    {% endif %}
                </td>
                <td class="px-4 py-2 text-gray-400 text-xs">
                    {{ r.sent_at.strftime('%m/%d %H:%M') if r.sent_at else '-' }}
                </td>
                <td class="px-4 py-2 text-gray-400 text-xs">
                    {{ r.clicked_at.strftime('%m/%d %H:%M') if r.clicked_at else '-' }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p class="text-gray-400 text-sm">No review requests yet for this business.</p>
{% endif %}

{% elif selected_id is none %}
<p class="text-gray-400 text-sm">Select a business to view stats.</p>
{% endif %}
{% endblock %}
